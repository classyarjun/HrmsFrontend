
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />

<div
  class="container d-flex justify-content-center align-items-center vh-100"
  style="background: linear-gradient(135deg, #252525 0%, #182848 100%)"
>
  <div
    class="card shadow-2xl p-5 rounded-5 border-0"
    style="max-width: 420px; width: 100%; background: #ffffffee;"
  >
    <!-- Title -->
    <h3
      class="mb-4 text-center fw-bold"
      [ngClass]="{ 'text-primary': step === 1, 'text-success': step === 2 }"
      style="text-shadow: 1px 1px 5px rgba(0,0,0,0.15);"
    >
      {{ step === 1 ? 'Forgot Password' : 'Reset Password' }}
    </h3>

    <!-- Animated alert messages -->
    <div
      *ngIf="alertMessage"
      class="alert d-flex align-items-center alert-dismissible fade show slide-in"
      [ngClass]="{
        'alert-success': alertType === 'success',
        'alert-danger': alertType === 'error'
      }"
      role="alert"
    >
      <i
        class="bi flex-shrink-0 me-2"
        [ngClass]="{
          'bi-check-circle-fill': alertType === 'success',
          'bi-exclamation-triangle-fill': alertType === 'error'
        }"
        style="font-size: 1.4rem;"
      ></i>
      <div>{{ alertMessage }}</div>
      <button
        type="button"
        class="btn-close ms-auto"
        aria-label="Close"
        (click)="alertMessage = ''"
      ></button>
    </div>

    <!-- Step 1: Email -->
    <form *ngIf="step === 1" (ngSubmit)="sendOtp()" novalidate #emailForm="ngForm" autocomplete="off">
      <div class="form-floating mb-4 position-relative">
        <input
          type="email"
          class="form-control form-control-lg ps-5"
          id="floatingEmail"
          placeholder="name@example.com"
          name="email"
          [(ngModel)]="email"
          required
          email
          #emailInput="ngModel"
          autocomplete="email"
          spellcheck="false"
        />
        <label for="floatingEmail">
          <i class=""></i>Enter your email
        </label>
        <div
          class="invalid-feedback d-block"
          *ngIf="emailInput.invalid && emailInput.touched"
        >
          Please enter a valid email.
        </div>
      </div>
      <button
        type="submit"
        class="btn btn-primary btn-lg w-100 fw-semibold text-uppercase letter-spacing"
        [disabled]="emailForm.invalid"
      >
        Send OTP
      </button>
    </form>

    <!-- Step 2: OTP + New Password -->
    <form
      *ngIf="step === 2"
      (ngSubmit)="resetPassword()"
      novalidate
      #resetForm="ngForm"
      autocomplete="off"
    >
      <div class="form-floating mb-3 position-relative">
        <input
          type="text"
          class="form-control form-control-lg ps-5"
          id="floatingOtp"
          placeholder="Enter OTP"
          name="otp"
          [(ngModel)]="otp"
          required
          minlength="4"
          maxlength="6"
          #otpInput="ngModel"
          autocomplete="one-time-code"
          spellcheck="false"
        />
        <label for="floatingOtp">
          <i class="n"></i>Enter OTP
        </label>
        <div
          class="invalid-feedback d-block"
          *ngIf="otpInput.invalid && otpInput.touched"
        >
          Please enter a valid OTP (4-6 digits).
        </div>
      </div>

      <div class="form-floating mb-3 position-relative">
        <input
          type="password"
          class="form-control form-control-lg ps-5"
          id="floatingPassword"
          placeholder="New Password"
          name="password"
          [(ngModel)]="password"
          required
          minlength="6"
          #passwordInput="ngModel"
          (input)="checkPasswordStrength(password)"
          autocomplete="new-password"
        />
        <label for="floatingPassword">
          <i class=""></i>New Password
        </label>
        <div
          class="invalid-feedback d-block"
          *ngIf="passwordInput.invalid && passwordInput.touched"
        >
          Password must be at least 6 characters.
        </div>
      </div>

      <!-- Password Strength Meter -->
      <div class="mb-3">
        <small>Password Strength:</small>
        <div class="progress" style="height: 10px; border-radius: 8px; overflow: hidden;">
          <div
            class="progress-bar"
            role="progressbar"
            [style.width]="passwordStrength + '%'"
            [class.bg-danger]="passwordStrength <= 40"
            [class.bg-warning]="passwordStrength > 40 && passwordStrength <= 70"
            [class.bg-success]="passwordStrength > 70"
            aria-valuemin="0"
            aria-valuemax="100"
          ></div>
        </div>
      </div>

      <div class="form-floating mb-4 position-relative">
        <input
          type="password"
          class="form-control form-control-lg ps-5"
          id="floatingConfirmPassword"
          placeholder="Confirm Password"
          name="confirmPassword"
          [(ngModel)]="confirmPassword"
          required
          #confirmPasswordInput="ngModel"
          autocomplete="new-password"
        />
        <label for="floatingConfirmPassword">
          <i class=""></i>Confirm Password
        </label>
        <div
          class="invalid-feedback d-block"
          *ngIf="confirmPassword !== password && confirmPasswordInput.touched"
        >
          Passwords do not match.
        </div>
      </div>

      <button
        type="submit"
        class="btn btn-success btn-lg w-100 fw-semibold text-uppercase letter-spacing"
        [disabled]="
          resetForm.invalid || (password !== confirmPassword) || passwordStrength < 30
        "
      >
        Reset Password
      </button>
    </form>
  </div>
</div>
